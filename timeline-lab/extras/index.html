<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Timeline Lab — extras (inline)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- CSS TimelineJS -->
  <link rel="stylesheet" href="https://cdn.knightlab.com/libs/timeline3/latest/css/timeline.css">
  <style>
    :root { --maxw: 1200px; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif; }
    header { background:#333; color:#fff; padding:12px 16px; }
    header a { color:#fff; text-decoration:none; opacity:.85 }
    header a:hover { opacity:1 }
    main { max-width: var(--maxw); margin: 0 auto; padding: 0 12px; }
    #timeline-embed { width:100%; height:650px; }
    #extra { max-width: 900px; margin: 24px auto; padding: 16px; border-top:1px solid #ddd; background:#f9f9f9 }
    #extra em { color:#666 }
  </style>
</head>
<body>

<header>
  <div style="display:flex;gap:12px;align-items:center">
    <strong>Timeline Lab — extras</strong>
    <a href="../">← retour au lab</a>
  </div>
</header>

<main>
  <!-- Frise KnightLab (INLINE, pas d’iframe) -->
  <div id="timeline-embed"></div>

  <!-- Zone de contenu additionnel -->
  <div id="extra">
    <em>Choisissez un événement pour afficher le contenu détaillé ici.</em>
  </div>
</main>

<!-- JS TimelineJS -->
<script src="https://cdn.knightlab.com/libs/timeline3/latest/js/timeline.js"></script>
<script>
  // 1) SOURCE DES DONNÉES — export CSV (robuste, évite "Invalid referrer")
  //    Ici, ton onglet "od1" est gid=0.
  const sheet = "https://docs.google.com/spreadsheets/d/1gnHKhlMRXwb_4UmhgZhqg4VNNHbBSHXBDKryf0qpQjQ/pub?gid=0&single=true&output=csv";

  // 2) Options Timeline
  const options = { language: "fr", hash_bookmark: true };

  // 3) Instanciation inline
  const timeline = new TL.Timeline("timeline-embed", sheet, options);

  // 4) Mapping des contenus additionnels par Unique ID (colonne "Unique ID" dans la Sheet)
  //    Ici on pointe vers des fichiers du même dossier (extras/)
  const EXTRA = {
    "event-rencontre-publique": { mode: "url", value: "16_octobre_2025.html" }
    // Exemple d’ajout :
    // "journal-2025-09-12": { mode:"url", value:"2025-09-12.html" },
    // "un-id-inline": { mode:"html", value:"<h3>Bloc</h3><p>Texte…</p>" }
  };

  const extraDiv = document.getElementById("extra");

  // 5) Rendu du contenu additionnel selon le hash (#UniqueID ou #slide-N)
  function renderExtraFromHash() {
    const raw = (window.location.hash || "").replace(/^#/, ""); // ex: event-rencontre-publique ou slide-3
    if (!raw || raw.startsWith("slide-")) {
      extraDiv.innerHTML = `<em>Choisissez un événement pour afficher le contenu détaillé ici.</em>`;
      return;
    }
    const item = EXTRA[raw];
    if (!item) {
      extraDiv.innerHTML = `<em>Aucun contenu additionnel prévu pour <code>${raw}</code>.</em>`;
      return;
    }
    if (item.mode === "html") {
      extraDiv.innerHTML = item.value;
    } else if (item.mode === "url") {
      fetch(item.value, { cache: "no-store" })
        .then(r => r.ok ? r.text() : Promise.reject(r.status))
        .then(html => { extraDiv.innerHTML = html; })
        .catch(() => { extraDiv.innerHTML = `<em>Contenu indisponible.</em>`; });
    }
  }

  // 6) Initialiser et écouter les changements
  timeline.on("loaded", renderExtraFromHash);
  window.addEventListener("hashchange", renderExtraFromHash);
</script>

</body>
</html>
